---
import { getCollection } from "astro:content";
import Layout from "@layouts/Layout.astro";
import Header from "@components/Header.astro";
import Footer from "@components/Footer.astro";
import LinkButton from "@components/LinkButton.astro";
import Hr from "@components/Hr.astro";
import Card from "@components/Card";
import Socials from "@components/Socials.astro";
import getSortedPosts from "@utils/getSortedPosts";
import { SOCIALS } from "@config";

// Import projects from JSON
let projectsData;
try {
  projectsData = await import("../content/data/projects.json");
} catch (e) {
  console.error("Failed to load projects.json:", e);
  projectsData = { default: [] };
}

// Get the actual array
const projects = Array.isArray(projectsData.default) ? projectsData.default : [];

// Reverse to show latest first
const sortedProjects = [...projects].reverse();

// Split into featured and non-featured
const featuredProjects = sortedProjects.filter(project => project.featured === true);
const recentProjects = sortedProjects.filter(project => project.featured !== true);

const socialCount = SOCIALS.filter((social) => social.active).length;
---

<Layout>
  <Header />
  <main id="main-content">
    <section id="hero">
      <h1 id="greeting" class="typewriter"></h1>

      <p>
        <br />
        Sanket here, but the internet knows me as Vadapav
        <br />
        <br />

        I build data pipelines, automate boring stuff, and will fight anyone who says The Office isn't peak television. Previously worked as a Business Analyst at Hapag-Lloyd building automation tools, now finishing my MS at Uni Bielefeld while curating Spotify playlists nobody asked for.
      </p>

      {
        // only display if at least one social link is enabled
        socialCount > 0 && (
          <div class="social-wrapper">
            <div class="social-links">Social Links:</div>
            <Socials />
          </div>
        )
      }
    </section>

    <Hr />

    {featuredProjects.length > 0 && (
      <>
        <section id="featured">
          <h2>Featured Projects</h2>
          <ul>
            {featuredProjects.map(project => (
              <Card
                href={project.link}
                frontmatter={{
                  title: project.title,
                  description: project.description,
                  technologies: project.technologies
                }}
                secHeading={false}
              />
            ))}
          </ul>
        </section>
        {recentProjects.length > 0 && <Hr />}
      </>
    )}
 {recentProjects.length > 0 && (
      <section id="recent-posts">
        <h2>Recent Projects</h2>
        <ul>
          {recentProjects.map((project, index) => (
            index < 4 && (
              <Card
                href={project.link}
                frontmatter={{
                  title: project.title,
                  description: project.description,
                  technologies: project.technologies
                }}
                secHeading={false}
              />
            )
          ))}
        </ul>
      </section>
    )}

    <div class="all-posts-btn-wrapper">
      <LinkButton href="/Projects/">
        All Projects
        <svg xmlns="http://www.w3.org/2000/svg"
          ><path
            d="m11.293 17.293 1.414 1.414L19.414 12l-6.707-6.707-1.414 1.414L15.586 11H6v2h9.586z"
          ></path>
        </svg>
      </LinkButton>
    </div> 
  </main>

  <Footer />
</Layout>

<script>
  import { initTypewriter } from "../utils/typewriter";
  
  const greetings = [
    "Hello ğŸ‘‹",
    "à¤¨à¤®à¤¸à¥à¤•à¤¾à¤° ğŸ™",
    "Hei ğŸ‘‹",          
    "ã“ã‚“ã«ã¡ã¯ ğŸ‘‹",     
    "Hola ğŸ‘‹",         
    "ä½ å¥½ ğŸ‘‹",          
    "Hei ğŸ‘‹",           
    "Hej ğŸ‘‹"
    ];
  
  initTypewriter("greeting", greetings);
</script>

<style>
  /* ===== Hero Section ===== */
  #hero {
    @apply pb-6 pt-8;
  }
  #hero h1 {
    @apply my-4 inline-block text-3xl font-bold sm:my-8 sm:text-5xl;
    min-height: 3.5rem;
  }
   @media (min-width: 640px) {
    #hero h1 {
      min-height: 3.5rem; /* Larger min-height for larger screens */
    }
  }

  .typewriter {
    border-right: 2px solid currentColor;
    padding-right: 5px;
    animation: blink 0.7s infinite;
  }
  
  @keyframes blink {
    0%, 50% { border-color: currentColor; }
    51%, 100% { border-color: transparent; }
  }
  #hero .rss-link {
    @apply mb-6;
  }
  #hero .rss-icon {
    @apply mb-2 h-6 w-6 scale-110 fill-skin-accent sm:mb-3 sm:scale-125;
  }
  #hero p {
    @apply my-2;
  }
  .social-wrapper {
    @apply mt-4 flex flex-col sm:flex-row sm:items-center;
  }
  .social-links {
    @apply mb-1 mr-2 whitespace-nowrap sm:mb-0;
  }

  /* ===== Featured & Recent Posts Sections ===== */
  #featured,
  #recent-posts {
    @apply pb-6 pt-12;
  }
  #featured h2,
  #recent-posts h2 {
    @apply text-2xl font-semibold tracking-wide;
  }
  .all-posts-btn-wrapper {
    @apply my-8 text-center;
  }
</style>
